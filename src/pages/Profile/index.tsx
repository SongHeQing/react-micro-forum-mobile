import styles from "./index.module.scss";
import defaultAvatar from "@/assets/默认用户头像.jpg";
import { useEffect, useState } from "react";
import { getUserProfile } from "@/apis/userApi";
import type { UserProfile } from "@/types/User";
import { Toast } from "antd-mobile";
import { useNavigate } from "react-router";
import { useSelector } from "react-redux";
import { RootState } from "@/store";


const Profile = () => {
  const [userProfile, setUserProfile] = useState<UserProfile | null>(null);
  const navigate = useNavigate();
  useEffect(() => {
    getUserProfile()
      .then((data) => {
        setUserProfile(data);
      })
      .catch((error) => {
        console.error("获取用户信息失败:", error);
        Toast.show({ icon: 'fail', content: '获取用户信息失败' });
      })
  }, []);

  const user = useSelector((state: RootState) => state.user)


  return (
    <div className={styles.profile}>
      {/* 上固定栏 */}
      <div className={styles.topBar}>
        <svg onClick={() => navigate('/settings')} className={styles.icon} viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1572" width="200" height="200"><path d="M888.911 361.177h-1.696a63.435 63.435 0 0 1-54.92-31.69l-2.054-3.552a63.448 63.448 0 0 1-0.015-63.474l0.846-1.464c25.492-44.154 10.364-100.615-33.79-126.107L695.946 76.383C681.409 67.99 665.534 64.001 649.874 64c-31.906-0.002-62.935 16.556-80.034 46.173l-0.017 0.027a66.241 66.241 0 0 1-57.366 33.121H512l-2.036 0.001h-0.036a63.437 63.437 0 0 1-54.941-31.721c-17.404-30.145-48.991-46.997-81.465-46.998-15.942-0.001-32.096 4.06-46.895 12.604l-99.909 57.682c-44.154 25.493-59.282 81.953-33.79 126.107a66.375 66.375 0 0 1-0.017 66.403l-0.376 0.651a66.308 66.308 0 0 1-57.407 33.125h-0.039c-50.985 0-92.316 41.331-92.316 92.316v117.014c0 50.984 41.331 92.316 92.316 92.316h1.696a63.435 63.435 0 0 1 54.92 31.69l1.206 2.086a66.376 66.376 0 0 1 0.017 66.402h-0.001c-25.492 44.154-10.363 100.614 33.79 126.106l101.337 58.508C342.591 956.009 358.466 960 374.126 960c31.906 0 62.935-16.556 80.035-46.174l0.016-0.027a66.237 66.237 0 0 1 57.364-33.12H512l2.036-0.001h0.036a63.437 63.437 0 0 1 54.941 31.721l0.825 1.428C586.937 943.441 617.97 960 649.873 960c15.663 0 31.533-3.989 46.072-12.384l101.337-58.507c44.154-25.492 59.282-81.952 33.79-126.106a66.375 66.375 0 0 1 0.017-66.403l0.376-0.651a66.306 66.306 0 0 1 57.407-33.125h0.039c50.985 0 92.316-41.332 92.316-92.316V453.493c0.001-50.985-41.331-92.316-92.316-92.316z m12.317 209.33c0 6.791-5.525 12.316-12.355 12.316-52.072 0-100.609 28.006-127.045 73.741-26.102 45.155-26.116 101.268-0.037 146.438 3.396 5.881 1.374 13.429-4.508 16.824l-101.338 58.508c-1.94 1.12-3.927 1.665-6.071 1.665-1.687 0-7.445-0.445-10.765-6.195l-0.813-1.406c-25.541-44.239-73.142-71.721-124.298-71.721l-2.457 0.001c-52.079 0-100.608 28.019-126.647 73.121l-0.069 0.121c-3.316 5.638-9.021 6.079-10.698 6.079-2.146 0-4.132-0.545-6.072-1.666l-101.337-58.508c-3.65-2.107-5.136-5.23-5.738-7.478-0.602-2.248-0.877-5.694 1.23-9.346 26.079-45.168 26.064-101.279-0.04-146.445l-1.2-2.076c-25.547-44.2-73.131-71.658-124.184-71.658h-1.696c-6.791 0-12.316-5.525-12.316-12.316V453.493c0-6.791 5.525-12.316 12.355-12.316 52.072 0 100.608-28.007 127.045-73.741 26.102-45.156 26.116-101.269 0.037-146.438-3.396-5.882-1.373-13.43 4.508-16.825l99.91-57.683c2.198-1.27 4.452-1.887 6.891-1.887 1.91 0 8.437 0.506 12.186 6.998 25.541 44.239 73.141 71.722 124.298 71.722l2.455-0.001c51.677 0 99.859-27.59 126.042-72.08l0.114-0.188 0.509-0.881c3.308-5.728 9.063-6.173 10.748-6.173 2.147 0 4.136 0.545 6.076 1.665l101.336 58.507c5.882 3.396 7.903 10.943 4.515 16.813l-0.853 1.477c-25.557 44.266-25.543 99.253 0.042 143.52l2.045 3.537c25.547 44.2 73.131 71.658 124.184 71.658h1.696c6.791 0 12.316 5.525 12.316 12.316v117.014z" p-id="1573"></path><path d="M512 352c-88.365 0-160 71.634-160 160 0 88.365 71.635 160 160 160s160-71.635 160-160c0-88.366-71.635-160-160-160z m0 240c-44.112 0-80-35.888-80-80s35.888-80 80-80 80 35.888 80 80-35.888 80-80 80z" p-id="1574"></path></svg>
      </div>
      {/* 用户区域 */}
      <div className={styles.userInfo}
        onClick={() =>
          // 从redux获取用户id帮助跳转路由传参
          navigate(`/user/${user.userInfo.id}`)
        }>
        {/* 头像 */}
        <div className={styles.avatar}>
          <img
            src={userProfile?.image || defaultAvatar}
            alt="用户头像"
          />
        </div>
        <div className={styles.userInfotext}>
          {/* 昵称 */}
          <div className={styles.nickname}>{userProfile?.nickname}</div>
          {/* 关注粉丝等级 */}
          <div className={styles.followAndFans}>
            <div className={styles.follow}>关注 <span>{userProfile?.followCount}</span></div>
            <div className={styles.fans}>粉丝 <span>{userProfile?.fansCount}</span></div>
            <div className={styles.level}>Lv.1</div>
          </div>
        </div>
      </div>
      {/* 互动显示区域 */}
      {/* 我的发帖、我的回帖、我专注的吧 */}
      <div className={styles.userStats}>
        <div className={styles.userStatsItem}>
          <div className={styles.Count}>{userProfile?.articleSendCount}</div>
          <div className={styles.Name}>我的发帖</div>
        </div>
        <div className={styles.userStatsItem}>
          <div className={styles.Count}>{userProfile?.commentSendCount}</div>
          <div className={styles.Name}>我的回帖</div>
        </div>
        <div className={styles.userStatsItem}>
          <div className={styles.Count}>{userProfile?.channelFollowCount}</div>
          <div className={styles.Name}>我关注的吧</div>
        </div>
      </div>
      {/* 功能分区 */}
      <div className={styles.functionArea}>
        {/* 常用功能 */}
        <div className={styles.commonFunction}>
          <div className={styles.Name}>常用功能</div>
          {/* 收藏、点赞、历史、创建频道 */}
          <div className={styles.functionList}>
            <div className={styles.functionItem}>
              {/* icon */}
              <div className={styles.Icon}>
                <svg className={styles.Icon} viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5127" width="200" height="200"><path d="M512 154.542c8.174 0 28.547 2.272 41.166 23.315l63.639 106.126c25.384 42.332 67.532 72.955 115.637 84.015l120.598 27.729c23.913 5.498 32.369 24.173 34.895 31.947 2.526 7.774 6.661 27.853-9.452 46.356l-81.269 93.321c-32.415 37.223-48.514 86.771-44.168 135.938l10.895 123.265c1.542 17.449-5.727 29.404-12.096 36.361-9.332 10.194-22.296 16.041-35.567 16.041-6.32 0-12.694-1.348-18.944-4.008l-113.865-48.453c-22.725-9.67-46.771-14.573-71.467-14.573s-48.742 4.903-71.467 14.573l-113.864 48.453c-6.25 2.66-12.625 4.008-18.946 4.008-13.274 0-26.239-5.846-35.57-16.038-6.368-6.956-13.636-18.911-12.093-36.364l10.895-123.264c4.345-49.169-11.754-98.717-44.169-135.939l-81.267-93.319c-16.114-18.503-11.979-38.582-9.453-46.355 2.526-7.774 10.982-26.449 34.895-31.947l120.598-27.729c48.104-11.061 90.253-41.683 115.637-84.015l63.64-106.127c12.615-21.046 32.988-23.317 41.162-23.317m0-80c-42.461 0-84.921 20.725-109.776 62.173l-63.639 106.127a102.522 102.522 0 0 1-64.953 47.191l-120.598 27.729C58.833 339.422 21.71 453.676 85.189 526.569l81.267 93.319a102.521 102.521 0 0 1 24.81 76.357l-10.895 123.264c-6.911 78.189 55.876 139.445 127.353 139.445 16.541 0 33.555-3.283 50.269-10.396l113.865-48.453a102.506 102.506 0 0 1 80.286 0l113.865 48.453c16.72 7.115 33.723 10.396 50.269 10.396 71.471 0 134.264-61.262 127.353-139.445l-10.895-123.264a102.525 102.525 0 0 1 24.81-76.357l81.268-93.319c63.479-72.893 26.355-187.147-67.846-208.807L750.37 290.033a102.522 102.522 0 0 1-64.953-47.191l-63.639-106.127C596.921 95.266 554.461 74.542 512 74.542z" p-id="5128"></path></svg>
              </div>
              <div>我的收藏</div>
            </div>
            <div className={styles.functionItem}>
              <div className={styles.Icon}>
                <svg className={styles.Icon} viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5298" width="200" height="200"><path d="M795.769 342.896c-0.007 0 0.005 0 0 0H685.4c-0.849 0-1.489-0.69-1.262-1.508 4.144-14.865 21.546-84.656 4.471-153.887C668.02 104.026 601.913 64.003 542.469 64c-32.186-0.002-62.412 11.729-82.415 34.647-56.944 65.247-19.396 88.469-52.796 175.756-28.589 74.718-96.736 94.832-115.814 99.091l-5.188 1.037h-93.46c-70.692 0-128 57.308-128 128V816c0 70.692 57.308 128 128 128h511.09c88.992 0 166.321-61.153 186.831-147.751l60.745-256.479c23.799-100.487-52.431-196.874-155.693-196.874zM144.795 816V502.531c0-26.467 21.532-48 48-48h48V864h-48c-26.468 0-48-21.533-48-48z m728.82-294.667l-60.746 256.479C800.851 828.559 756.034 864 703.885 864h-383.09V448.497c38.811-11.046 123.048-45.847 161.181-145.505 18.542-48.459 20.521-83.044 21.966-108.297 1.396-24.407 1.511-26.401 16.385-43.444 3.904-4.473 12.387-7.252 22.139-7.251 24.457 0.001 57.065 16.412 68.472 62.659 9.14 37.052 3.955 76.38-0.277 97.734-5.33 22.173-17.249 50.663-28.257 74.365-9.891 21.296 5.923 45.558 29.402 45.32l116.708-1.184h67.256c24.607 0 47.478 11.072 62.745 30.379 15.267 19.308 20.771 44.115 15.1 68.06z" p-id="5299"></path></svg>
              </div>
              <div>我的点赞</div>
            </div>
            <div className={styles.functionItem}>
              <div className={styles.Icon}>
                <svg className={styles.Icon} viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5467" width="200" height="200"><path d="M512 64C264.577 64 64 264.576 64 512c0 247.423 200.577 448 448 448 247.424 0 448-200.577 448-448 0-247.424-200.576-448-448-448z m0 816c-202.916 0-368-165.084-368-368s165.084-368 368-368 368 165.084 368 368-165.084 368-368 368z" p-id="5468"></path><path d="M560 504.681V280c0-22.092-17.908-40-40-40-22.091 0-40 17.908-40 40v240c0 11.156 4.586 21.226 11.953 28.48 0.271 0.319 0.449 0.684 0.731 0.997l122.402 135.941c7.899 8.772 18.796 13.235 29.739 13.235a39.863 39.863 0 0 0 26.752-10.274c16.417-14.782 17.742-40.074 2.961-56.491L560 504.681z" p-id="5469"></path></svg>
              </div>
              <div>浏览历史</div>
            </div>
            <div className={styles.functionItem}>
              <div className={styles.Icon}>
                <svg viewBox="0 0 28 28" fill="none" >
                  <path d="M14 5V23" stroke="white" strokeWidth="5" strokeLinecap="round" />
                  <path d="M5 14H23" stroke="white" strokeWidth="5" strokeLinecap="round" />
                </svg>
              </div>
              <div>创建频道</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default Profile;
